{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { map, skip, BehaviorSubject, catchError, EMPTY } from 'rxjs';\nimport { HttpHeaders } from '@angular/common/http';\nimport { AutoUnsubscribe } from 'ngx-auto-unsubscribe';\nimport { MatAccordion } from '@angular/material/expansion';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"@wizardcontrollerprerelease/horseless-contentapi-lib\";\nimport * as i3 from \"angular-auth-oidc-client\";\nimport * as i4 from \"./services/TenantChooser.service\";\nimport * as i5 from \"../../services/configuration-endpoint.service\";\n\nfunction TenantChooserComponent_div_0_ng_template_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"p-dataViewLayoutOptions\");\n  }\n}\n\nfunction TenantChooserComponent_div_0_ng_template_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtext(0);\n  }\n\n  if (rf & 2) {\n    const tenant_r13 = ctx.$implicit;\n    i0.ɵɵtextInterpolate1(\" \", tenant_r13.DisplayName, \" \");\n  }\n}\n\nfunction TenantChooserComponent_div_0_ng_template_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 2)(1, \"p-card\")(2, \"div\", 13)(3, \"div\", 14);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"div\", 14);\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"div\", 14);\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelement(9, \"br\");\n    i0.ɵɵelementStart(10, \"div\");\n    i0.ɵɵtext(11, \"access control list\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(12, \"lib-hostingAccessControlEntry-table\", 15)(13, \"br\");\n    i0.ɵɵelementStart(14, \"div\");\n    i0.ɵɵtext(15, \"principals\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(16, \"lib-contentPrincipal-table\", 16);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const tenant_r14 = ctx.$implicit;\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", tenant_r14.DisplayName, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", tenant_r14.TenantIdentifier, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", tenant_r14.BaseUrl, \" \");\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"accessControlEntries\", tenant_r14.AccessControlEntries);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"principals\", tenant_r14.Owners);\n  }\n}\n\nfunction TenantChooserComponent_div_0_ng_template_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"p-dataViewLayoutOptions\");\n  }\n}\n\nfunction TenantChooserComponent_div_0_ng_template_28_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"p-dataViewLayoutOptions\");\n  }\n}\n\nfunction TenantChooserComponent_div_0_ng_template_29_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtext(0);\n  }\n\n  if (rf & 2) {\n    const tenant_r15 = ctx.$implicit;\n    i0.ɵɵtextInterpolate1(\" \", tenant_r15.DisplayName, \" \");\n  }\n}\n\nfunction TenantChooserComponent_div_0_ng_template_30_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 2)(1, \"p-card\")(2, \"div\", 13)(3, \"div\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"div\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"div\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelement(9, \"br\");\n    i0.ɵɵelementStart(10, \"div\");\n    i0.ɵɵtext(11, \"access control list\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(12, \"lib-contentAccessControlEntry-table\", 15)(13, \"br\");\n    i0.ɵɵelementStart(14, \"div\");\n    i0.ɵɵtext(15, \"principals\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(16, \"lib-contentPrincipal-table\", 16);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const tenant_r16 = ctx.$implicit;\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", tenant_r16.DisplayName, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", tenant_r16.TenantIdentifier, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", tenant_r16.BaseUrl, \" \");\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"accessControlEntries\", tenant_r16.AccessControlEntries);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"principals\", tenant_r16.Owners);\n  }\n}\n\nfunction TenantChooserComponent_div_0_ng_template_31_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"p-dataViewLayoutOptions\");\n  }\n}\n\nfunction TenantChooserComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r18 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 2)(1, \"mat-tab-group\", 3)(2, \"mat-tab\", 4)(3, \"mat-accordion\")(4, \"mat-expansion-panel\", 5);\n    i0.ɵɵlistener(\"opened\", function TenantChooserComponent_div_0_Template_mat_expansion_panel_opened_4_listener() {\n      i0.ɵɵrestoreView(_r18);\n      const ctx_r17 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r17.panelOpenState = true);\n    })(\"closed\", function TenantChooserComponent_div_0_Template_mat_expansion_panel_closed_4_listener() {\n      i0.ɵɵrestoreView(_r18);\n      const ctx_r19 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r19.panelOpenState = false);\n    });\n    i0.ɵɵelementStart(5, \"mat-expansion-panel-header\")(6, \"mat-panel-title\");\n    i0.ɵɵtext(7, \"hosting tenant admin \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"mat-panel-description\");\n    i0.ɵɵtext(9, \" tenant administration portal \");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(10, \"p-dataView\", 6, 7);\n    i0.ɵɵlistener(\"onLazyLoad\", function TenantChooserComponent_div_0_Template_p_dataView_onLazyLoad_10_listener($event) {\n      i0.ɵɵrestoreView(_r18);\n      const ctx_r20 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r20.pullHostingEntitiesTenantsByOffset($event));\n    });\n    i0.ɵɵpipe(12, \"async\");\n    i0.ɵɵtemplate(13, TenantChooserComponent_div_0_ng_template_13_Template, 1, 0, \"ng-template\", 8);\n    i0.ɵɵtemplate(14, TenantChooserComponent_div_0_ng_template_14_Template, 1, 1, \"ng-template\", 9);\n    i0.ɵɵtemplate(15, TenantChooserComponent_div_0_ng_template_15_Template, 17, 5, \"ng-template\", 10);\n    i0.ɵɵtemplate(16, TenantChooserComponent_div_0_ng_template_16_Template, 1, 0, \"ng-template\", 11);\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementStart(17, \"mat-tab\", 12)(18, \"mat-accordion\")(19, \"mat-expansion-panel\", 5);\n    i0.ɵɵlistener(\"opened\", function TenantChooserComponent_div_0_Template_mat_expansion_panel_opened_19_listener() {\n      i0.ɵɵrestoreView(_r18);\n      const ctx_r21 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r21.panelOpenState = true);\n    })(\"closed\", function TenantChooserComponent_div_0_Template_mat_expansion_panel_closed_19_listener() {\n      i0.ɵɵrestoreView(_r18);\n      const ctx_r22 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r22.panelOpenState = false);\n    });\n    i0.ɵɵelementStart(20, \"mat-expansion-panel-header\")(21, \"mat-panel-title\");\n    i0.ɵɵtext(22, \" content tenant admin \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(23, \"mat-panel-description\");\n    i0.ɵɵtext(24, \" tenant administration portal \");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(25, \"p-dataView\", 6, 7);\n    i0.ɵɵlistener(\"onLazyLoad\", function TenantChooserComponent_div_0_Template_p_dataView_onLazyLoad_25_listener($event) {\n      i0.ɵɵrestoreView(_r18);\n      const ctx_r23 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r23.pullContentEntitiesTenantsByOffset($event));\n    });\n    i0.ɵɵpipe(27, \"async\");\n    i0.ɵɵtemplate(28, TenantChooserComponent_div_0_ng_template_28_Template, 1, 0, \"ng-template\", 8);\n    i0.ɵɵtemplate(29, TenantChooserComponent_div_0_ng_template_29_Template, 1, 1, \"ng-template\", 9);\n    i0.ɵɵtemplate(30, TenantChooserComponent_div_0_ng_template_30_Template, 17, 5, \"ng-template\", 10);\n    i0.ɵɵtemplate(31, TenantChooserComponent_div_0_ng_template_31_Template, 1, 0, \"ng-template\", 11);\n    i0.ɵɵelementEnd()()()()()();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(10);\n    i0.ɵɵproperty(\"paginator\", true)(\"rows\", 5)(\"lazy\", true)(\"totalRecords\", ctx_r0.tenantChooserService.hostingEntitiesTenantsCount)(\"value\", i0.ɵɵpipeBind1(12, 10, ctx_r0.hostingModelTenant$));\n    i0.ɵɵadvance(15);\n    i0.ɵɵproperty(\"paginator\", true)(\"rows\", 5)(\"lazy\", true)(\"totalRecords\", ctx_r0.tenantChooserService.contentEntitiesTenantsCount)(\"value\", i0.ɵɵpipeBind1(27, 12, ctx_r0.contentModelTenant$));\n  }\n}\n\nfunction TenantChooserComponent_ng_template_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"span\");\n    i0.ɵɵtext(2, \"unauthorized\");\n    i0.ɵɵelementEnd()();\n  }\n}\n\nlet TenantChooserComponent = class TenantChooserComponent {\n  constructor(router, tenantSvc, oidcAuthSvc, tenantChooserSvc, clientConfigService) {\n    this.router = router;\n    this.clientConfigService = clientConfigService;\n    this.panelOpenState = false;\n    this.currentTenantIdentifier = '';\n    this.contentTenantsCount = 0;\n    this.hostingTenantsCount = 0;\n    this.isAuthenticated$ = new BehaviorSubject(false);\n    this.hostingEntitiesPageSize = 5;\n    this.hostingEntitiesPageCount = 2;\n    this.hostingEntitiesPageNumber = 1;\n    this.contentEntitiesPageSize = 5;\n    this.contentEntitiesPageCount = 2;\n    this.contentEntitiesPageNumber = 1;\n    this.defaultTenant = 'lache';\n    this.tenantService = tenantSvc;\n    this.oidcService = oidcAuthSvc;\n    this.tenantChooserService = tenantChooserSvc;\n    this.hostingModelTenant$ = this.tenantChooserService.hostingEntitiesTenantsSubject.pipe(map(entities => {\n      if (entities != null && entities != undefined && entities.entries != null && entities.entries != undefined) {\n        console.log(`${entities === null || entities === void 0 ? void 0 : entities.length} entities retrieved`);\n        this.hostingTenants = entities;\n        this.hostingTenantsCount = this.hostingTenants.length;\n      }\n\n      return entities;\n    }));\n    this.contentModelTenant$ = this.tenantChooserService.contentEntitiesTenantsSubject.pipe(map(entities => {\n      if (entities != null && entities != undefined) {\n        console.log(`${entities === null || entities === void 0 ? void 0 : entities.length} entities retrieved`);\n        this.contentTenants = entities;\n        this.contentTenantsCount = this.hostingTenants.length;\n      }\n\n      return entities;\n    }));\n  }\n\n  ngOnInit() {\n    let applicationJson = new HttpHeaders();\n    applicationJson.append('Accept', 'application/json'); // this.tenantChooserService.restClientConfiguration$\n    //     .pipe(\n    //         skip(1),\n    //         tap(t => {\n    //           console.log('tenant chooser component is pulling configuration and tenant counts');\n    //         }),\n    //         map((clientConfiguration) => {\n    //         this.tenantChooserService.pullContentEntitiesTenantsCount();\n    //         return clientConfiguration;\n    //       }),\n    //       map((clientConfiguration) => {\n    //         this.tenantChooserService.pullHostingEntitiesTenantsCount();\n    //         return clientConfiguration;\n    //       }),\n    //       tap(t => {\n    //         console.log('tenant chooser component has pulled configuration and tenant counts');\n    //       })\n    //     ).subscribe();\n\n    try {\n      this.tenantChooserService.restClientConfiguration$.pipe(skip(1), map(clientConfiguration => {\n        if (clientConfiguration.AccessToken != null && clientConfiguration.AccessToken != undefined) {\n          console.log('theant chooser component is handling client configuration result');\n          this.isAuthenticated$.next(true);\n        }\n\n        return clientConfiguration;\n      }), map(clientConfiguration => {\n        try {\n          this.tenantChooserService.pullContentEntitiesTenantsByOffset(0, this.contentEntitiesPageSize);\n        } catch (exception) {\n          console.log(`tenantchoosercomponent threw exception ${exception}`);\n        }\n\n        return clientConfiguration;\n      }), map(clientConfiguration => {\n        try {\n          this.tenantChooserService.pullHostingEntitiesTenantsByOffset(0, this.hostingEntitiesPageSize);\n        } catch (exception) {\n          console.log(`tenantchoosercomponent threw exception ${exception}`);\n        }\n      }), catchError(err => {\n        console.log(`TenantChooserComponent tenantChooserService.restClientConfiguration$ handling error ${err}`);\n        return EMPTY;\n      })).subscribe(piped => {\n        console.log(`tenantChooserService.restClientConfiguration$  pipe subscriber executing`);\n      });\n    } catch (error) {\n      console.log('exception pulling client configiuration');\n    } // this.oidcService\n    //  .checkAuth(window.location.href)\n    //  .subscribe((x) => (this.isAuthenticated = x.isAuthenticated));\n    // prime the async pump\n\n  }\n\n  pullHostingEntitiesTenantsByOffset(event) {\n    //event.first = First row offset\n    //event.rows = Number of rows per page\n    console.log('pullHostingEntitiesTenantsByOffset starting');\n    this.tenantChooserService.pullHostingEntitiesTenantsByOffset(event.first, event.rows);\n    console.log(`pullHostingEntitiesTenantsByOffset finished event.first ${event.first}, event.rows ${event.rows}`);\n  }\n\n  pullContentEntitiesTenantsByOffset(event) {\n    //event.first = First row offset\n    //event.rows = Number of rows per page\n    console.log('pullContentEntitiesTenantsByOffset starting');\n    this.tenantChooserService.pullContentEntitiesTenantsByOffset(event.first, event.rows);\n    console.log(`pullContentEntitiesTenantsByOffset finished event.first ${event.first}, event.rows ${event.rows}`);\n  }\n\n  ngOnDestroy() {// We'll throw an error if it doesn't\n  }\n\n};\n\nTenantChooserComponent.ɵfac = function TenantChooserComponent_Factory(t) {\n  return new (t || TenantChooserComponent)(i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i2.TenantRESTService), i0.ɵɵdirectiveInject(i3.OidcSecurityService), i0.ɵɵdirectiveInject(i4.TenantChooserService), i0.ɵɵdirectiveInject(i5.ConfigurationEndpointService));\n};\n\nTenantChooserComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: TenantChooserComponent,\n  selectors: [[\"lib-tenant-chooser\"]],\n  viewQuery: function TenantChooserComponent_Query(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵviewQuery(MatAccordion, 5);\n    }\n\n    if (rf & 2) {\n      let _t;\n\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.accordion = _t.first);\n    }\n  },\n  decls: 4,\n  vars: 4,\n  consts: [[\"class\", \"container\", 4, \"ngIf\", \"ngIfElse\"], [\"unauthorized\", \"\"], [1, \"container\"], [\"dynamicHeight\", \"\"], [\"label\", \"Hosting\"], [3, \"opened\", \"closed\"], [\"layout\", \"grid\", 3, \"paginator\", \"rows\", \"lazy\", \"totalRecords\", \"value\", \"onLazyLoad\"], [\"dv\", \"\"], [\"pTemplate\", \"header\"], [\"pTemplate\", \"listItem\"], [\"pTemplate\", \"gridItem\"], [\"pTemplate\", \"footer\"], [\"label\", \"Content\"], [1, \"row\"], [1, \"col\"], [3, \"accessControlEntries\"], [3, \"principals\"]],\n  template: function TenantChooserComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵtemplate(0, TenantChooserComponent_div_0_Template, 32, 14, \"div\", 0);\n      i0.ɵɵpipe(1, \"async\");\n      i0.ɵɵtemplate(2, TenantChooserComponent_ng_template_2_Template, 3, 0, \"ng-template\", null, 1, i0.ɵɵtemplateRefExtractor);\n    }\n\n    if (rf & 2) {\n      const _r1 = i0.ɵɵreference(3);\n\n      i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(1, 2, ctx.isAuthenticated$))(\"ngIfElse\", _r1);\n    }\n  },\n  styles: [\".card[_ngcontent-%COMP%]{padding:2rem;box-shadow:0 2px 1px -1px #0003,0 1px 1px #00000024,0 1px 3px #0000001f;border-radius:4px;margin-bottom:2rem}.action-buttons[_ngcontent-%COMP%]{padding-bottom:20px}.headers-align[_ngcontent-%COMP%]   .mat-expansion-panel-header-title[_ngcontent-%COMP%], .headers-align[_ngcontent-%COMP%]   .mat-expansion-panel-header-description[_ngcontent-%COMP%]{flex-basis:0}.headers-align[_ngcontent-%COMP%]   .mat-expansion-panel-header-description[_ngcontent-%COMP%]{justify-content:space-between;align-items:center}\"]\n});\nTenantChooserComponent = __decorate([AutoUnsubscribe()], TenantChooserComponent);\nexport { TenantChooserComponent };\n\nfunction AutoDestroy() {\n  throw new Error('Function not implemented.');\n}\n\nfunction ngOnDestroy() {\n  throw new Error('Function not implemented.');\n}","map":null,"metadata":{},"sourceType":"module"}